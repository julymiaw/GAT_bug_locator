# 仓库介绍

## 运行步骤

```shell
# 将类级别的文件依赖图保存为文件级别
python save_graph_fold_dataframes.py {file_prefix}

# 将数据载入内存
python load_data_to_joblib_memmap.py {file_prefix}

# 评估数据集的依赖边数与连通情况
python evaluate_dataset.py {file_prefix}

# 训练模型
python train_adaptive_GAT.py {file_prefix}

# 评估模型
python evaluator.py {log_dir}
```

## 数据集评估结果

### AspectJ数据集的图结构和消息传播特性评估结果

1. 基本统计

    | 指标              | 数值  |
    | ----------------- | ----- |
    | 总bug数           | 576   |
    | 总文件数          | 19340 |
    | 修复文件比例      | 0.12% |
    | 平均每个bug的边数 | 11752 |

2. 图结构特性

    | 指标             | 均值     | 标准差  |
    | ---------------- | -------- | ------- |
    | 节点数量         | 2325.76  | 692.24  |
    | 边数量           | 11846.05 | 3980.96 |
    | 图密度           | 0.0047   | 0.0015  |
    | 修复文件数       | 2.91     | 6.14    |
    | 连通分量数       | 18.28    | 6.10    |
    | 最大连通分量大小 | 2308.49  | 696.27  |
    | 平均路径长度     | 2.50     | 0.07    |
    | 消息传递效率     | 0.40     | 0.01    |

3. 消息传播特性

    | 指标                 | 数值  |
    | -------------------- | ----- |
    | 到修复文件的平均跳数 | 1.93  |
    | 不可达节点比例       | 1.57% |
    | 平均邻居数           | 10.04 |

4. 跳数分布

    | 跳数             | 节点占比 |
    | ---------------- | -------- |
    | 0 (修复文件本身) | 0.15%    |
    | 1                | 2.22%    |
    | 2                | 71.86%   |
    | 3                | 23.74%   |
    | 4                | 0.46%    |
    | 5                | <0.01%   |
    | 不可达           | 1.57%    |

**评估结论**：AspectJ数据集具有良好的连通性（98.43%的节点可达修复文件），较短的平均路径长度（2.50），且71.86%的节点在2跳范围内可达修复文件，表明该数据集非常适合基于消息传递机制的GAT模型。图密度较低(0.0047)但每个节点平均有10.04个邻居，为消息传递提供了足够的通道。

### Tomcat数据集的图结构和消息传播特性评估结果

1. 基本统计

    | 指标              | 数值   |
    | ----------------- | ------ |
    | 总bug数           | 1045   |
    | 总文件数          | 16698  |
    | 修复文件比例      | 0.17%  |
    | 平均每个bug的边数 | 5012.1 |

2. 图结构特性

    | 指标             | 均值    | 标准差  |
    | ---------------- | ------- | ------- |
    | 节点数量         | 1150.68 | 236.86  |
    | 边数量           | 5011.30 | 1180.58 |
    | 图密度           | 0.0078  | 0.0013  |
    | 修复文件数       | 2.11    | 4.88    |
    | 连通分量数       | 57.40   | 3.32    |
    | 最大连通分量大小 | 1088.13 | 232.74  |
    | 平均路径长度     | 3.61    | 0.16    |
    | 消息传递效率     | 0.28    | 0.01    |

3. 消息传播特性

    | 指标                 | 数值  |
    | -------------------- | ----- |
    | 到修复文件的平均跳数 | 3.36  |
    | 不可达节点比例       | 8.29% |
    | 平均邻居数           | 8.66  |

4. 跳数分布

    | 跳数             | 节点占比 |
    | ---------------- | -------- |
    | 0 (修复文件本身) | 0.19%    |
    | 1                | 2.81%    |
    | 2                | 27.84%   |
    | 3                | 38.38%   |
    | 4                | 15.29%   |
    | 5                | 4.77%    |
    | 6                | 1.70%    |
    | 7                | 0.57%    |
    | 8                | 0.13%    |
    | 9                | 0.02%    |
    | 10               | <0.01%   |
    | 不可达           | 8.29%    |

**评估结论**：Tomcat数据集相比AspectJ具有更高的图密度(0.0078)和更大的平均路径长度(3.61)。虽然连通性略低(91.71%的节点可达修复文件)，但消息传递结构较丰富，大约66.22%的节点在2-3跳范围内可达修复文件，每个节点平均有8.66个邻居。这种图结构特性也适合GAT模型的消息传递机制，但可能需要处理更多跳距的信息传递。

## 模型训练与评估结果

### AspectJ数据集

1. 原始模型(SGDRegressor)结果

    | 属性        | 分数   |     | 属性        | 分数   |
    | ----------- | ------ | --- | ----------- | ------ |
    | Accuracy@1  | 0.1842 |     | Accuracy@11 | 0.6447 |
    | Accuracy@2  | 0.2895 |     | Accuracy@12 | 0.6579 |
    | Accuracy@3  | 0.3684 |     | Accuracy@13 | 0.6579 |
    | Accuracy@4  | 0.4079 |     | Accuracy@14 | 0.6711 |
    | Accuracy@5  | 0.4605 |     | Accuracy@15 | 0.6711 |
    | Accuracy@6  | 0.5000 |     | Accuracy@16 | 0.6711 |
    | Accuracy@7  | 0.5132 |     | Accuracy@17 | 0.6711 |
    | Accuracy@8  | 0.5921 |     | Accuracy@18 | 0.6711 |
    | Accuracy@9  | 0.6447 |     | Accuracy@19 | 0.6842 |
    | Accuracy@10 | 0.6447 |     | Accuracy@20 | 0.7105 |
    | MAP         | 0.2665 |     | MRR         | 0.3175 |

2. GAT模型(图注意力网络)结果

    | 属性        | 分数   |     | 属性        | 分数   |
    | ----------- | ------ | --- | ----------- | ------ |
    | Accuracy@1  | 0.3026 |     | Accuracy@11 | 0.5789 |
    | Accuracy@2  | 0.3421 |     | Accuracy@12 | 0.6053 |
    | Accuracy@3  | 0.3816 |     | Accuracy@13 | 0.6316 |
    | Accuracy@4  | 0.4079 |     | Accuracy@14 | 0.6447 |
    | Accuracy@5  | 0.4474 |     | Accuracy@15 | 0.6711 |
    | Accuracy@6  | 0.4737 |     | Accuracy@16 | 0.6842 |
    | Accuracy@7  | 0.5000 |     | Accuracy@17 | 0.6974 |
    | Accuracy@8  | 0.5263 |     | Accuracy@18 | 0.7105 |
    | Accuracy@9  | 0.5395 |     | Accuracy@19 | 0.7237 |
    | Accuracy@10 | 0.5526 |     | Accuracy@20 | 0.7237 |
    | MAP         | 0.3301 |     | MRR         | 0.3825 |

3. 模型性能对比分析

    | 模型         | MAP    | MRR    | Accuracy@1 | Accuracy@5 | Accuracy@10 | Accuracy@20 |
    | ------------ | ------ | ------ | ---------- | ---------- | ----------- | ----------- |
    | SGDRegressor | 0.2665 | 0.3175 | 0.1842     | 0.4605     | 0.6447      | 0.7105      |
    | GAT模型      | 0.3301 | 0.3825 | 0.3026     | 0.4474     | 0.5526      | 0.7237      |
    | 提升百分比   | 23.9%  | 20.5%  | 64.3%      | -2.8%      | -14.3%      | 1.9%        |

### Tomcat数据集

1. 原始模型(SGDRegressor)结果

    | 属性        | 分数   |     | 属性        | 分数   |
    | ----------- | ------ | --- | ----------- | ------ |
    | Accuracy@1  | 0.4294 |     | Accuracy@11 | 0.7101 |
    | Accuracy@2  | 0.5266 |     | Accuracy@12 | 0.7174 |
    | Accuracy@3  | 0.5780 |     | Accuracy@13 | 0.7229 |
    | Accuracy@4  | 0.6092 |     | Accuracy@14 | 0.7303 |
    | Accuracy@5  | 0.6294 |     | Accuracy@15 | 0.7358 |
    | Accuracy@6  | 0.6514 |     | Accuracy@16 | 0.7376 |
    | Accuracy@7  | 0.6679 |     | Accuracy@17 | 0.7431 |
    | Accuracy@8  | 0.6807 |     | Accuracy@18 | 0.7450 |
    | Accuracy@9  | 0.6954 |     | Accuracy@19 | 0.7486 |
    | Accuracy@10 | 0.7064 |     | Accuracy@20 | 0.7523 |
    | MAP         | 0.5275 |     | MRR         | 0.5232 |

2. 改进的GAT模型(图注意力网络)结果

    | 属性        | 分数   |     | 属性        | 分数   |
    | ----------- | ------ | --- | ----------- | ------ |
    | Accuracy@1  | 0.4550 |     | Accuracy@11 | 0.7284 |
    | Accuracy@2  | 0.5505 |     | Accuracy@12 | 0.7321 |
    | Accuracy@3  | 0.5872 |     | Accuracy@13 | 0.7376 |
    | Accuracy@4  | 0.6220 |     | Accuracy@14 | 0.7431 |
    | Accuracy@5  | 0.6550 |     | Accuracy@15 | 0.7505 |
    | Accuracy@6  | 0.6716 |     | Accuracy@16 | 0.7541 |
    | Accuracy@7  | 0.6899 |     | Accuracy@17 | 0.7560 |
    | Accuracy@8  | 0.7009 |     | Accuracy@18 | 0.7596 |
    | Accuracy@9  | 0.7064 |     | Accuracy@19 | 0.7615 |
    | Accuracy@10 | 0.7174 |     | Accuracy@20 | 0.7615 |
    | MAP         | 0.5482 |     | MRR         | 0.5445 |

3. 模型性能对比分析

    | 模型          | MAP    | MRR    | Accuracy@1 | Accuracy@5 | Accuracy@10 | Accuracy@20 |
    | ------------- | ------ | ------ | ---------- | ---------- | ----------- | ----------- |
    | SGDRegressor  | 0.5275 | 0.5232 | 0.4294     | 0.6294     | 0.7064      | 0.7523      |
    | 改进的GAT模型 | 0.5482 | 0.5445 | 0.4550     | 0.6550     | 0.7174      | 0.7615      |
    | 提升百分比    | 3.92%  | 4.07%  | 5.96%      | 4.07%      | 1.56%       | 1.22%       |
