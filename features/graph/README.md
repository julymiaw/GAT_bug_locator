# 仓库介绍

## 运行步骤

```shell
# 将类级别的文件依赖图保存为文件级别
python save_graph_fold_dataframes.py {file_prefix}

# 将数据载入内存
python load_data_to_joblib_memmap.py {file_prefix}

# 评估数据集的依赖边数与连通情况
python evaluate_dataset.py {file_prefix}

# 训练模型
python train_adaptive_GAT.py {file_prefix}

# 评估模型
python evaluator.py {log_dir}
```

## 数据集评估结果

### AspectJ数据集的图结构和消息传播特性评估结果

1. 基本统计

    | 指标              | 数值     |
    | ----------------- | -------- |
    | 总bug数           | 576      |
    | 总文件数          | 19340    |
    | 修复文件比例      | 0.123%   |
    | 平均每个bug的边数 | 11752.08 |

2. 图结构特性

    | 指标             | 均值     | 标准差  |
    | ---------------- | -------- | ------- |
    | 节点数量         | 2325.76  | 692.24  |
    | 边数量           | 11459.61 | 3853.50 |
    | 图密度           | 0.00457  | 0.00141 |
    | 修复文件数       | 2.91     | 6.14    |
    | 连通分量数       | 18.28    | 6.10    |
    | 最大连通分量大小 | 2308.49  | 696.27  |
    | 平均路径长度     | 2.50     | 0.05    |
    | 消息传递效率     | 0.40     | 0.01    |

3. 消息传播特性

    | 指标                 | 数值  |
    | -------------------- | ----- |
    | 到修复文件的平均跳数 | 1.93  |
    | 不可达节点比例       | 1.57% |
    | 平均邻居数           | 9.72  |

4. 跳数分布

    | 跳数             | 节点占比 |
    | ---------------- | -------- |
    | 0 (修复文件本身) | 0.15%    |
    | 1                | 2.22%    |
    | 2                | 71.86%   |
    | 3                | 23.74%   |
    | 4                | 0.46%    |
    | 5                | <0.01%   |
    | 不可达           | 1.57%    |

**评估结论**：AspectJ数据集具有良好的连通性（98.43%的节点可达修复文件），较短的平均路径长度（2.50），且71.86%的节点在2跳范围内可达修复文件，表明该数据集非常适合基于消息传递机制的GAT模型。图密度较低(0.00457)但每个节点平均有9.72个邻居，为消息传递提供了足够的通道。

### Tomcat数据集的图结构和消息传播特性评估结果

1. 基本统计

    | 指标              | 数值    |
    | ----------------- | ------- |
    | 总bug数           | 1045    |
    | 总文件数          | 16698   |
    | 修复文件比例      | 0.165%  |
    | 平均每个bug的边数 | 5012.08 |

2. 图结构特性

    | 指标             | 均值    | 标准差  |
    | ---------------- | ------- | ------- |
    | 节点数量         | 1150.68 | 236.86  |
    | 边数量           | 5011.30 | 1180.58 |
    | 图密度           | 0.00779 | 0.00130 |
    | 修复文件数       | 2.11    | 4.88    |
    | 连通分量数       | 57.40   | 3.32    |
    | 最大连通分量大小 | 1088.13 | 232.74  |
    | 平均路径长度     | 3.61    | 0.09    |
    | 消息传递效率     | 0.28    | 0.01    |

3. 消息传播特性

    | 指标                 | 数值  |
    | -------------------- | ----- |
    | 到修复文件的平均跳数 | 3.36  |
    | 不可达节点比例       | 8.29% |
    | 平均邻居数           | 8.49  |

4. 跳数分布

    | 跳数             | 节点占比 |
    | ---------------- | -------- |
    | 0 (修复文件本身) | 0.19%    |
    | 1                | 2.81%    |
    | 2                | 27.84%   |
    | 3                | 38.38%   |
    | 4                | 15.29%   |
    | 5                | 4.77%    |
    | 6                | 1.70%    |
    | 7                | 0.57%    |
    | 8                | 0.13%    |
    | 9                | 0.02%    |
    | 10               | <0.01%   |
    | 不可达           | 8.29%    |

**评估结论**：Tomcat数据集相比AspectJ具有更高的图密度(0.00779)和更大的平均路径长度(3.61)。虽然连通性略低(91.71%的节点可达修复文件)，但消息传递结构较丰富，大约66.22%的节点在2-3跳范围内可达修复文件，每个节点平均有8.49个邻居。这种图结构特性也适合GAT模型的消息传递机制，但可能需要处理更多跳距的信息传递。

### SWT数据集的图结构和消息传播特性评估结果

1. 基本统计

    | 指标              | 数值    |
    | ----------------- | ------- |
    | 总bug数           | 4141    |
    | 总文件数          | 50437   |
    | 修复文件比例      | 0.089%  |
    | 平均每个bug的边数 | 8423.95 |

2. 图结构特性

    | 指标             | 均值    | 标准差  |
    | ---------------- | ------- | ------- |
    | 节点数量         | 1181.29 | 355.57  |
    | 边数量           | 8675.91 | 2884.92 |
    | 图密度           | 0.01361 | 0.00455 |
    | 修复文件数       | 1.75    | 3.23    |
    | 连通分量数       | 9.92    | 2.21    |
    | 最大连通分量大小 | 1171.96 | 353.06  |
    | 平均路径长度     | 2.63    | 0.05    |
    | 消息传递效率     | 0.38    | 0.01    |

3. 消息传播特性

    | 指标                 | 数值  |
    | -------------------- | ----- |
    | 到修复文件的平均跳数 | 2.07  |
    | 不可达节点比例       | 0.96% |
    | 平均邻居数           | 14.24 |

4. 跳数分布

    | 跳数             | 节点占比 |
    | ---------------- | -------- |
    | 0 (修复文件本身) | 0.16%    |
    | 1                | 12.68%   |
    | 2                | 66.32%   |
    | 3                | 18.70%   |
    | 4                | 1.14%    |
    | 5                | 0.03%    |
    | 6                | <0.01%   |
    | 不可达           | 0.96%    |

**评估结论**：SWT数据集具有极高的连通性(99.04%的节点可达修复文件)和较高的图密度(0.01361)。平均路径长度较短(2.63)，且大多数节点(66.32%)在2跳范围内可达修复文件，每个节点平均有14.24个邻居，这些特性使得SWT数据集非常适合基于消息传递的GNN模型。数据集的连通分量数较少(9.92)，表明图的结构更加紧凑。

### JDT数据集的图结构和消息传播特性评估结果

1. 基本统计

    | 指标              | 数值    |
    | ----------------- | ------- |
    | 总bug数           | 6247    |
    | 总文件数          | 60774   |
    | 修复文件比例      | 0.090%  |
    | 平均每个bug的边数 | 7456.48 |

2. 图结构特性

    | 指标         | 均值    | 标准差  |
    | ------------ | ------- | ------- |
    | 节点数量     | 2138.56 | 904.84  |
    | 边数量       | 7819.92 | 3997.81 |
    | 图密度       | 0.00395 | 0.00201 |
    | 修复文件数   | 2.06    | 2.86    |
    | 连通分量数   | 139.20  | 40.86   |
    | 平均路径长度 | 4.27    | 0.15    |
    | 消息传递效率 | 0.23    | 0.01    |

3. 消息传播特性

    | 指标                 | 数值   |
    | -------------------- | ------ |
    | 到修复文件的平均跳数 | 5.16   |
    | 不可达节点比例       | 10.24% |
    | 平均邻居数           | 6.86   |

4. 跳数分布

    | 跳数             | 节点占比 |
    | ---------------- | -------- |
    | 0 (修复文件本身) | 0.13%    |
    | 1                | 1.32%    |
    | 2                | 13.63%   |
    | 3                | 28.54%   |
    | 4                | 28.05%   |
    | 5                | 12.29%   |
    | 6                | 3.78%    |
    | 7                | 1.10%    |
    | 8                | 0.44%    |
    | 9                | 0.22%    |
    | 10               | 0.17%    |
    | 11-16            | <0.10%   |
    | 不可达           | 10.24%   |

**评估结论**：JDT数据集的连通性较低(89.76%的节点可达修复文件)，平均路径长度较长(4.27)，表明信息需要经过更多的跳数才能传播到修复文件。连通分量数较多(139.20)，说明图结构较为分散。虽然图密度较低(0.00395)，平均邻居数也不高(6.86)，但56.59%的节点集中在3-4跳范围内可达修复文件，这对于设计使用多层GNN是一个重要考虑因素。

### Eclipse Platform UI数据集的图结构和消息传播特性评估结果

1. 基本统计

    | 指标              | 数值     |
    | ----------------- | -------- |
    | 总bug数           | 6433     |
    | 总文件数          | 76915    |
    | 修复文件比例      | 0.065%   |
    | 平均每个bug的边数 | 12475.71 |

2. 图结构特性

    | 指标         | 均值     | 标准差  |
    | ------------ | -------- | ------- |
    | 节点数量     | 2848.56  | 1445.29 |
    | 边数量       | 12996.04 | 7210.21 |
    | 图密度       | 0.00424  | 0.00267 |
    | 修复文件数   | 2.11     | 6.23    |
    | 连通分量数   | 118.27   | 50.37   |
    | 平均路径长度 | 3.94     | 0.30    |
    | 消息传递效率 | 0.26     | 0.02    |

3. 消息传播特性

    | 指标                 | 数值  |
    | -------------------- | ----- |
    | 到修复文件的平均跳数 | 3.92  |
    | 不可达节点比例       | 6.94% |
    | 平均邻居数           | 8.84  |

4. 跳数分布

    | 跳数             | 节点占比 |
    | ---------------- | -------- |
    | 0 (修复文件本身) | 0.10%    |
    | 1                | 1.71%    |
    | 2                | 17.71%   |
    | 3                | 35.95%   |
    | 4                | 26.29%   |
    | 5                | 8.30%    |
    | 6                | 2.21%    |
    | 7                | 0.55%    |
    | 8                | 0.14%    |
    | 9-15             | <0.10%   |
    | 不可达           | 6.94%    |

**评估结论**：Eclipse Platform UI数据集具有较好的连通性(93.06%的节点可达修复文件)，平均路径长度中等(3.94)。图密度较低(0.00424)但平均邻居数适中(8.84)。这个数据集的特点是大多数节点(62.24%)集中在3-4跳范围内可达修复文件，连通分量数量较多(118.27)。这种结构适合使用多层GNN模型进行消息传递，特别是需要关注3-4跳范围内的信息聚合。

### BIRT数据集的图结构和消息传播特性评估结果

1. 基本统计

    | 指标              | 数值     |
    | ----------------- | -------- |
    | 总bug数           | 4141     |
    | 总文件数          | 65604    |
    | 修复文件比例      | 0.042%   |
    | 平均每个bug的边数 | 39098.23 |

2. 图结构特性

    | 指标         | 均值     | 标准差   |
    | ------------ | -------- | -------- |
    | 节点数量     | 6255.05  | 2085.56  |
    | 边数量       | 38648.80 | 14329.09 |
    | 图密度       | 0.00223  | 0.00094  |
    | 修复文件数   | 2.60     | 5.92     |
    | 连通分量数   | 227.90   | 55.47    |
    | 平均路径长度 | 3.66     | 0.05     |
    | 消息传递效率 | 0.27     | <0.01    |

3. 消息传播特性

    | 指标                 | 数值  |
    | -------------------- | ----- |
    | 到修复文件的平均跳数 | 4.30  |
    | 不可达节点比例       | 6.37% |
    | 平均邻居数           | 12.09 |

4. 跳数分布

    | 跳数             | 节点占比 |
    | ---------------- | -------- |
    | 0 (修复文件本身) | 0.05%    |
    | 1                | 0.94%    |
    | 2                | 22.90%   |
    | 3                | 37.23%   |
    | 4                | 22.89%   |
    | 5                | 6.83%    |
    | 6                | 1.90%    |
    | 7                | 0.64%    |
    | 8                | 0.20%    |
    | 9                | 0.04%    |
    | 10-12            | <0.01%   |
    | 不可达           | 6.37%    |

**评估结论**：BIRT数据集是规模最大的数据集之一，具有较高的节点数量(6255.05)和极高的边数量(38648.80)。虽然图密度较低(0.00223)，但平均邻居数较高(12.09)，表明节点间的连接比较丰富。连通性良好(93.63%的节点可达修复文件)，但连通分量数极多(227.90)，说明图结构较为分散。数据显示83.02%的节点集中在2-4跳范围内可达修复文件，这种结构特点使得它适合使用3-4层的GNN模型来捕获足够范围内的信息传递。

## 模型训练与评估结果

### AspectJ数据集

1. 原始模型(SGDRegressor)结果

    | 属性        | 分数   |     | 属性        | 分数   |
    | ----------- | ------ | --- | ----------- | ------ |
    | Accuracy@1  | 0.1842 |     | Accuracy@11 | 0.6447 |
    | Accuracy@2  | 0.2895 |     | Accuracy@12 | 0.6579 |
    | Accuracy@3  | 0.3684 |     | Accuracy@13 | 0.6579 |
    | Accuracy@4  | 0.4079 |     | Accuracy@14 | 0.6711 |
    | Accuracy@5  | 0.4605 |     | Accuracy@15 | 0.6711 |
    | Accuracy@6  | 0.5000 |     | Accuracy@16 | 0.6711 |
    | Accuracy@7  | 0.5132 |     | Accuracy@17 | 0.6711 |
    | Accuracy@8  | 0.5921 |     | Accuracy@18 | 0.6711 |
    | Accuracy@9  | 0.6447 |     | Accuracy@19 | 0.6842 |
    | Accuracy@10 | 0.6447 |     | Accuracy@20 | 0.7105 |
    | MAP         | 0.2665 |     | MRR         | 0.3175 |

2. GAT模型结果

    | 属性        | 分数   |     | 属性        | 分数   |
    | ----------- | ------ | --- | ----------- | ------ |
    | Accuracy@1  | 0.2500 |     | Accuracy@11 | 0.6184 |
    | Accuracy@2  | 0.3421 |     | Accuracy@12 | 0.6316 |
    | Accuracy@3  | 0.3684 |     | Accuracy@13 | 0.6447 |
    | Accuracy@4  | 0.4211 |     | Accuracy@14 | 0.6579 |
    | Accuracy@5  | 0.4737 |     | Accuracy@15 | 0.6711 |
    | Accuracy@6  | 0.4868 |     | Accuracy@16 | 0.6842 |
    | Accuracy@7  | 0.5263 |     | Accuracy@17 | 0.6974 |
    | Accuracy@8  | 0.5395 |     | Accuracy@18 | 0.6974 |
    | Accuracy@9  | 0.5526 |     | Accuracy@19 | 0.6974 |
    | Accuracy@10 | 0.6053 |     | Accuracy@20 | 0.7105 |
    | MAP         | 0.3129 |     | MRR         | 0.3593 |

3. 模型性能对比分析

    | 模型         | MAP    | MRR    | Accuracy@1 | Accuracy@5 | Accuracy@10 | Accuracy@20 |
    | :----------- | :----- | :----- | :--------- | :--------- | :---------- | :---------- |
    | SGDRegressor | 0.2665 | 0.3175 | 0.1842     | 0.4605     | 0.6447      | 0.7105      |
    | GAT模型      | 0.3129 | 0.3593 | 0.2500     | 0.4737     | 0.6053      | 0.7105      |
    | 提升百分比   | 17.4%  | 13.2%  | 35.7%      | 2.9%       | -6.1%       | 0.0%        |

### Tomcat数据集

1. 原始模型(SGDRegressor)结果

    | 属性        | 分数   |     | 属性        | 分数   |
    | ----------- | ------ | --- | ----------- | ------ |
    | Accuracy@1  | 0.4294 |     | Accuracy@11 | 0.7101 |
    | Accuracy@2  | 0.5266 |     | Accuracy@12 | 0.7174 |
    | Accuracy@3  | 0.5780 |     | Accuracy@13 | 0.7229 |
    | Accuracy@4  | 0.6092 |     | Accuracy@14 | 0.7303 |
    | Accuracy@5  | 0.6294 |     | Accuracy@15 | 0.7358 |
    | Accuracy@6  | 0.6514 |     | Accuracy@16 | 0.7376 |
    | Accuracy@7  | 0.6679 |     | Accuracy@17 | 0.7431 |
    | Accuracy@8  | 0.6807 |     | Accuracy@18 | 0.7450 |
    | Accuracy@9  | 0.6954 |     | Accuracy@19 | 0.7486 |
    | Accuracy@10 | 0.7064 |     | Accuracy@20 | 0.7523 |
    | MAP         | 0.5275 |     | MRR         | 0.5232 |

2. 改进的GAT模型(图注意力网络)结果

    | 属性        | 分数   |     | 属性        | 分数   |
    | ----------- | ------ | --- | ----------- | ------ |
    | Accuracy@1  | 0.4550 |     | Accuracy@11 | 0.7284 |
    | Accuracy@2  | 0.5505 |     | Accuracy@12 | 0.7321 |
    | Accuracy@3  | 0.5872 |     | Accuracy@13 | 0.7376 |
    | Accuracy@4  | 0.6220 |     | Accuracy@14 | 0.7431 |
    | Accuracy@5  | 0.6550 |     | Accuracy@15 | 0.7505 |
    | Accuracy@6  | 0.6716 |     | Accuracy@16 | 0.7541 |
    | Accuracy@7  | 0.6899 |     | Accuracy@17 | 0.7560 |
    | Accuracy@8  | 0.7009 |     | Accuracy@18 | 0.7596 |
    | Accuracy@9  | 0.7064 |     | Accuracy@19 | 0.7615 |
    | Accuracy@10 | 0.7174 |     | Accuracy@20 | 0.7615 |
    | MAP         | 0.5482 |     | MRR         | 0.5445 |

3. 模型性能对比分析

    | 模型          | MAP    | MRR    | Accuracy@1 | Accuracy@5 | Accuracy@10 | Accuracy@20 |
    | ------------- | ------ | ------ | ---------- | ---------- | ----------- | ----------- |
    | SGDRegressor  | 0.5275 | 0.5232 | 0.4294     | 0.6294     | 0.7064      | 0.7523      |
    | 改进的GAT模型 | 0.5482 | 0.5445 | 0.4550     | 0.6550     | 0.7174      | 0.7615      |
    | 提升百分比    | 3.92%  | 4.07%  | 5.96%      | 4.07%      | 1.56%       | 1.22%       |
